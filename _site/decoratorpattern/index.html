<!DOCTYPE html> <html lang="en-US"> <head prefix="og: http://ogp.me/ns#"> <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="ie=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="Janessa Tran" /> <meta name="apple-mobile-web-app-status-bar-style" content="#fff" /> <meta name="apple-mobile-web-app-title" content="Janessa Tran" /> <title> Decorator Pattern in Ruby on Rails - Janessa Tran </title> <link rel="alternate" href="https://janessatran.com/decoratorpattern/" hreflang="en-US" /> <link rel="canonical" href="https://janessatran.com/decoratorpattern/" /> <meta name="description" content="Full-stack software engineer" /> <meta name="referrer" content="no-referrer-when-downgrade" /> <meta property="fb:app_id" content="" /> <meta property="og:site_name" content="Decorator Pattern in Ruby on Rails | " /> <meta property="og:title" content="Decorator Pattern in Ruby on Rails | " /> <meta property="og:type" content="website" /> <meta property="og:url" content="https://janessatran.com/decoratorpattern/" /> <meta property="og:description" content="Full-stack software engineer" /> <meta property="og:image" content="https://janessatran.com/assets/img/me.png" /> <meta property="og:image:width" content="640" /> <meta property="og:image:height" content="640" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:title" content="Decorator Pattern in Ruby on Rails | janessatran_" /> <meta name="twitter:url" content="https://janessatran.com/decoratorpattern/" /> <meta name="twitter:site" content="@janessatran_" /> <meta name="twitter:creator" content="@janessatran_" /> <meta name="twitter:description" content="Full-stack software engineer" /> <meta name="twitter:image" content="https://janessatran.com/assets/img/me.png" /> <link type="application/atom+xml" rel="alternate" href="https://janessatran.com/feed.xml" title="Janessa Tran" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png" /> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png" /> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png" /> <link rel="manifest" href="/assets/favicons/site.webmanifest" /> <link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.svg" color="#5bbad5" /> <meta name="apple-mobile-web-app-title" content="Jekyll Klise" /> <meta name="application-name" content="Jekyll Klise" /> <meta name="msapplication-TileColor" content="#da532c" /> <meta name="theme-color" content="#2c2c2c" /> <link rel="stylesheet" href="/assets/css/style.css" /> </head> <body data-theme="dark" class="notransition"> <script> const body = document.body; const data = body.getAttribute("data-theme"); const initTheme = (state) => { if (state === "dark") { body.setAttribute("data-theme", "dark"); } else if (state === "light") { body.removeAttribute("data-theme"); } else { localStorage.setItem("theme", data); } }; initTheme(localStorage.getItem("theme")); setTimeout(() => body.classList.remove("notransition"), 75); </script> <div class="navbar" role="navigation"> <nav class="menu"> <input type="checkbox" id="menu-trigger" class="menu-trigger" /> <label for="menu-trigger"> <span class="menu-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512"> <path d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z" /> </svg> </span> </label> <a id="mode"> <svg class="mode-sunny" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512"> <title>LIGHT</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> <svg class="mode-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512"> <title>DARK</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> </a> <div class="trigger"> <div class="trigger-container"><a class="menu-link" href="/">home</a><a class="menu-link" href="/archive/">archive</a><a class="menu-link" href="/projects/">projects</a><a class="menu-link rss" href="/feed.xml"> <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 512 512" fill="#ED812E"> <title>RSS</title> <path d="M108.56,342.78a60.34,60.34,0,1,0,60.56,60.44A60.63,60.63,0,0,0,108.56,342.78Z" /> <path d="M48,186.67v86.55c52,0,101.94,15.39,138.67,52.11s52,86.56,52,138.67h86.66C325.33,312.44,199.67,186.67,48,186.67Z" /> <path d="M48,48v86.56c185.25,0,329.22,144.08,329.22,329.44H464C464,234.66,277.67,48,48,48Z" /> </svg> </a> </div> </div> </nav> </div> <div class="wrapper post"> <main class="page-content" aria-label="Content"> <article itemscope itemtype="https://schema.org/BlogPosting"> <header class="header"> <div class="tags"> <span itemprop="keywords"> <a class="tag" href="/tags/#ruby-on-rails">RUBY ON RAILS</a>, <a class="tag" href="/tags/#design-patterns">DESIGN PATTERNS</a> </span> </div> <h1 class="header-title" itemprop="headline">Decorator Pattern in Ruby on Rails</h1> <div class="post-meta"> <time datetime="2020-11-06T00:00:00-08:00" itemprop="datePublished"> Nov 06, 2020 </time> <span itemprop="author" itemscope itemtype="https://schema.org/Person"> <span itemprop="name">Janessa Tran</span> </span> <time hidden datetime="" itemprop="dateModified"> Nov 06, 2020 </time> <span hidden itemprop="publisher" itemtype="Person">Janessa Tran</span> <span hidden itemprop="image"></span> <span hidden itemprop="mainEntityOfPage"><h2 id="what-is-the-decorator-pattern">What is the Decorator Pattern?</h2> </span> </div> </header> <div class="page-content" itemprop="articleBody"> <h2 id="what-is-the-decorator-pattern"> <a href="#what-is-the-decorator-pattern" class="anchor-head"></a> What is the Decorator Pattern? </h2> <p>It allows us to add functionality to an object of a class without affecting other instances of that class. The term “decorator” originates from the pattern of adding additional behavior onto a single object, among all the instances of the class you have a “decorated” instance.</p> <h2 id="how-do-we-use-that-in-ruby-on-rails"> <a href="#how-do-we-use-that-in-ruby-on-rails" class="anchor-head"></a> How do we use that in Ruby on Rails? </h2> <p>A common requirement in projects is to alter data in a model for the view layer. For example, say you have a <code class="language-plaintext highlighter-rouge">User</code> model with attributes <code class="language-plaintext highlighter-rouge">first_name</code> and <code class="language-plaintext highlighter-rouge">last_name</code> and you want to display the full name of the user in the view.</p> <p>In order to keep presentation logic out of the views and models<em>, which should always be the goal,</em> you can add it into a decorator class instead. This simplifies our views which should exclude logic as much as possible, and models which should not know about presentation. Then, we can decorate our instances as we need.</p> <h2 id="how-do-you-implement-the-decorator-pattern"> <a href="#how-do-you-implement-the-decorator-pattern" class="anchor-head"></a> How do you implement the Decorator Pattern? </h2> <p><ins>View Logic:</ins></p> <p>Let’s say we have a <code class="language-plaintext highlighter-rouge">User</code> class and an <code class="language-plaintext highlighter-rouge">Article</code> class. In two separate views, the <code class="language-plaintext highlighter-rouge">User</code> show page and <code class="language-plaintext highlighter-rouge">Article</code> index, we display the full name of the user by combining the <code class="language-plaintext highlighter-rouge">user.first_name</code> and <code class="language-plaintext highlighter-rouge">user.last_name</code></p> <p>On the user’s profile page:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># apps/views/users/show.html.haml</span>

<span class="o">%</span><span class="n">h1</span><span class="p">.</span><span class="nf">name</span><span class="o">-</span><span class="nb">display</span>
  <span class="o">=</span> <span class="vi">@user</span><span class="p">.</span><span class="nf">first_name</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="vi">@user</span><span class="p">.</span><span class="nf">last_name</span>

</code></pre></div></div> <p>In the index page of articles:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># apps/views/articles/index.html.haml</span>

<span class="o">%</span><span class="n">h1</span><span class="o">=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span>
<span class="p">.</span><span class="nf">author</span> <span class="no">Written</span> <span class="no">By</span> <span class="c1">#{@article.user.first_name + " " + @article.user.last_name}</span>
</code></pre></div></div> <p><ins>Code Smell:</ins></p> <p>Right away, we should detect a code smell! Firstly, we’re repeating code in multiple places. Secondly, we’re manipulating data directly in the view which we should <strong>avoid.</strong> Remember, the view should just be there and display things.</p> <p><ins>The Solution:</ins></p> <p>We can add a decorator pattern to improve this!</p> <ul> <li>Define a subdirectory, <code class="language-plaintext highlighter-rouge">app/decorators</code></li> <li>Define a file, <code class="language-plaintext highlighter-rouge">app/decorators/user_decorator.rb</code></li> </ul> <p>In this file we can define a <code class="language-plaintext highlighter-rouge">name_display</code> method which will contain the string manipulation logic to show the full name of the user. The class will inherit from <code class="language-plaintext highlighter-rouge">SimpleDelegator</code>, a native Ruby class that allows you to delegate methods calls to the object passed in during construction.</p> <p>As stated in the Ruby docs:</p> <blockquote> <p>“this class provides the means to delegate all supported method calls to the object passed into the constructor” - <a href="https://ruby-doc.org/stdlib-2.5.1/libdoc/delegate/rdoc/SimpleDelegator.html">ruby-doc</a></p> </blockquote> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/decorators/user_decorator.rb</span>

<span class="k">class</span> <span class="nc">UserDecorator</span> <span class="o">&lt;</span> <span class="no">SimpleDelegator</span>
  <span class="k">def</span> <span class="nf">name_display</span>
    <span class="c1">#{first_name last_name}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <h2 id="implementing-the-decorator-into-our-views"> <a href="#implementing-the-decorator-into-our-views" class="anchor-head"></a> Implementing the Decorator into our Views </h2> <p>Now we can use our decorators to simplify our views. First in the user’s profile page:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># apps/views/users/show.html.haml</span>

<span class="o">%</span><span class="n">h1</span><span class="p">.</span><span class="nf">name</span><span class="o">-</span><span class="nb">display</span>
  <span class="o">=</span> <span class="no">UserDecorator</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="vi">@user</span><span class="p">).</span><span class="nf">name_display</span>

</code></pre></div></div> <p>Then in the article index page:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># apps/views/articles/index.html.haml</span>

<span class="o">%</span><span class="n">h1</span><span class="o">=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span>
<span class="p">.</span><span class="nf">author</span> <span class="no">Written</span> <span class="no">By</span> <span class="c1">#{UserDecorator.new(@article.user).name_display}</span>
</code></pre></div></div> <h2 id="alternative-using-the-draper-gem"> <a href="#alternative-using-the-draper-gem" class="anchor-head"></a> Alternative: Using the Draper Gem </h2> <p>If you don’t want to create your own decorator class from scratch, you can also use the <a href="https://github.com/drapergem/draper">Draper Gem</a>.</p> <p>With Draper, you could write a Decorator Class like:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/decorators/user_decorator.rb</span>

<span class="k">class</span> <span class="nc">UserDecorator</span> <span class="o">&lt;</span> <span class="no">Draper</span><span class="o">::</span><span class="no">Decorator</span>
  <span class="n">delegate_all</span>

  <span class="k">def</span> <span class="nf">name_display</span>
    <span class="c1">#{object.first_name object.last_name}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>Then, you would call <code class="language-plaintext highlighter-rouge">decorate</code> in your controller like so:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/controllers/users_controller.rb</span>

<span class="k">def</span> <span class="nf">show</span>
  <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">]).</span><span class="nf">decorate</span>
<span class="k">end</span>
</code></pre></div></div> <p>And in your views:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/views/users/show.html.haml</span>

<span class="o">%</span><span class="n">h1</span><span class="p">.</span><span class="nf">name</span><span class="o">-</span><span class="nb">display</span>
  <span class="o">=</span> <span class="vi">@user</span><span class="p">.</span><span class="nf">name_display</span>
</code></pre></div></div> <h2 id="additional-resources"> <a href="#additional-resources" class="anchor-head"></a> Additional Resources </h2> <ul> <li>Decorator Pattern in Java: <a href="https://www.tutorialspoint.com/design_pattern/decorator_pattern.htm">TutorialsPoint</a></li> <li>Decorator in Ruby <a href="https://refactoring.guru/design-patterns/decorator/ruby/example">RefactoringGuru</a></li> </ul> </div> </article> </main> <nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/how-to-create-a-multistep-form-in-rails/" > <div class="nav-arrow">Previous</div> <span class="post-title">How to create a multi-step form in Ruby on Rails</span> </a> <a class="post-nav-item post-nav-next" href="/helpers-vs-concerns/"> <div class="nav-arrow">Next</div> <span class="post-title">Helpers vs. Concerns in Rails</span> </a> </nav> <footer class="footer"> <a class="footer_item" href="/thanks">ack.</a> <!-- <a class="footer_item" href="/assets/resume.pdf" download>resume</a> --> <a class="footer_item" href="/feed.xml">rss</a> <span class="footer_item">&copy; 2023</span> <small class="footer_copyright"> <!-- Klisé Theme: https://github.com/piharpi/jekyll-klise --> <a href="https://github.com/piharpi/jekyll-klise" target="_blank" rel="noreferrer noopener" >klisé</a > theme on <a href="https://jekyllrb.com" target="_blank" rel="noreferrer noopener" >jekyll</a > </small> </footer> <script src="/assets/js/main.js" defer="defer"></script> </div> </body> </html>
